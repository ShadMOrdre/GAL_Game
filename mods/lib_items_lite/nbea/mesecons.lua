--[[
--all code from MESECONS modpack
--by Jeija and contributors
--Licensed: LGPL version 3
--]]

--minor mesecons support

local nbea, sounds = {}, {}

function nbea.stop_sound(pos)
	local spos = minetest.hash_node_position(pos)
	if sounds[spos] then minetest.sound_stop(sounds[spos]) end
end

local nbea_rules = {
	{x=0,  y=0,  z=-1},
	{x=1,  y=0,  z=0},
	{x=-1, y=0,  z=0},
	{x=0,  y=0,  z=1},
	{x=1,  y=1,  z=0},
	{x=1,  y=-1, z=0},
	{x=-1, y=1,  z=0},
	{x=-1, y=-1, z=0},
	{x=0,  y=1,  z=1},
	{x=0,  y=-1, z=1},
	{x=0,  y=1,  z=-1},
	{x=0,  y=-1, z=-1},
	{x=0,  y=-1, z=0},
}



minetest.register_node("nbea:nbox_003_on", {
	description = "Inner-Cube",
	tiles = {
		{image = "nbea_core1.png",
		backface_culling = false,
			animation = {
				type = "vertical_frames",
				aspect_w = 16,
				aspect_h = 16,
				length = 1.25
			},
		}
	},
	use_texture_alpha = true,
	drawtype = "nodebox",
	paramtype = "light",
	light_source = 8,
	sunlight_propagates = true,
	is_ground_content = false,
    	drop = "nbea:nbox_003",
	groups = {cracky = 3, mesecon = 2, not_in_creative_inventory = 1},
	sounds = gal.node_sound_metal_defaults({
		footstep = {name = "default_glass_footstep", gain = 0.5},
		dug = {name = "default_break_glass", gain = 1.0},
	}),
	node_box = {
		type = "fixed",
		fixed = {
			-- corner frame
			{-0.5, 0.4375, -0.4375, -0.4375, 0.5, 0.4375},
			{-0.5, -0.5, -0.4375, -0.4375, -0.4375, 0.4375},
			{-0.5, -0.5, -0.5, -0.4375, 0.5, -0.4375},
			{-0.5, -0.5, 0.4375, -0.4375, 0.5, 0.5},
			{-0.4375, 0.4375, -0.5, 0.4375, 0.5, -0.4375},
			{-0.4375, -0.5, -0.5, 0.4375, -0.4375, -0.4375},
			{-0.4375, 0.4375, 0.4375, 0.4375, 0.5, 0.5},
			{-0.4375, -0.5, 0.4375, 0.4375, -0.4375, 0.5},
			{0.4375, 0.4375, -0.5, 0.5, 0.5, 0.5},
			{0.4375, -0.5, -0.5, 0.5, -0.4375, 0.5},
			{0.4375, -0.4375, 0.4375, 0.5, 0.4375, 0.5},
			{0.4375, -0.4375, -0.5, 0.5, 0.4375, -0.4375},
			-- center mass 2px--0.0625 / 4px--0.125 / 6px--0.1875
			{-0.0625, -0.0625, -0.0625, 0.0625, 0.0625, 0.0625},
		},
	},
	selection_box = {
		type = "fixed",
		fixed = {
			{-0.5, -0.5, -0.5, 0.5, 0.5, 0.5},
		},
	},
	mesecons = {effector = {
        rules = nbea_rules,
        action_off = function (pos, node)
            minetest.swap_node(pos, {name = "nbea:nbox_003", param2 = node.param2})
        end,
    }}
})

minetest.register_node("nbea:nbox_005_off", {
	description = "Core Sample",
	inventory_image = "nbea_core.png^nbea_steel.png",
	wield_image = "nbea_core.png^nbea_steel.png",
	tiles = {
		{image = "nbea_core3.png",
		backface_culling = false,
			animation = {
				type = "vertical_frames",
				aspect_w = 16,
				aspect_h = 16,
				length = 4.0
			},
		}
	},
	use_texture_alpha = true,
	drawtype = "nodebox",
	paramtype = "light",
	light_source = 5,
	sunlight_propagates = true,
	climbable = true,
	is_ground_content = false,
	groups = {cracky = 3, mesecon_effector_off = 1, mesecon = 1},
	sounds = gal.node_sound_metal_defaults({
		footstep = {name = "default_glass_footstep", gain = 0.5},
		dug = {name = "default_break_glass", gain = 1.0},
	}),
	node_box = {
		type = "fixed",
		fixed = {
			-- top (Y+)
			{-0.4375, 0.4375, 0.375, 0.4375, 0.5, 0.4375},
			{-0.4375, 0.4375, 0.25, 0.4375, 0.5, 0.3125},
			{-0.4375, 0.4375, -0.3125, 0.4375, 0.5, -0.25},
			{-0.4375, 0.4375, -0.4375, 0.4375, 0.5, -0.375},
			{-0.4375, 0.4375, -0.4375, -0.375, 0.5, 0.4375},
			{0.375, 0.4375, -0.4375, 0.4375, 0.5, 0.4375},
			{-0.3125, 0.4375, -0.375, -0.25, 0.5, 0.375},
			{0.25, 0.4375, -0.375, 0.3125, 0.5, 0.375},
			-- bottom (Y-)
			{-0.4375, -0.5, 0.375, 0.4375, -0.4375, 0.4375},
			{-0.4375, -0.5, 0.25, 0.4375, -0.4375, 0.3125},
			{-0.4375, -0.5, -0.3125, 0.4375, -0.4375, -0.25},
			{-0.4375, -0.5, -0.4375, 0.4375, -0.4375, -0.375},
			{0.375, -0.5, -0.4375, 0.4375, -0.4375, 0.4375},
			{-0.4375, -0.5, -0.4375, -0.375, -0.4375, 0.4375},
			{0.25, -0.5, -0.375, 0.3125, -0.4375, 0.375},
			{-0.3125, -0.5, -0.375, -0.25, -0.4375, 0.375},
			-- right (X+)
			{0.4375, -0.4375, 0.375, 0.5, 0.4375, 0.4375},
			{0.4375, -0.4375, 0.25, 0.5, 0.4375, 0.3125},
			{0.4375, -0.4375, -0.3125, 0.5, 0.4375, -0.25},
			{0.4375, -0.4375, -0.4375, 0.5, 0.4375, -0.375},
			{0.4375, 0.375, -0.4375, 0.5, 0.4375, 0.4375},
			{0.4375, -0.4375, -0.4375, 0.5, -0.375, 0.4375},
			{0.4375, 0.25, -0.375, 0.5, 0.3125, 0.375},
			{0.4375, -0.3125, -0.375, 0.5, -0.25, 0.375},
			-- left (X-)
			{-0.5, -0.4375, -0.4375, -0.4375, 0.4375, -0.375},
			{-0.5, -0.4375, -0.3125, -0.4375, 0.4375, -0.25},
			{-0.5, -0.4375, 0.25, -0.4375, 0.4375, 0.3125},
			{-0.5, -0.4375, 0.375, -0.4375, 0.4375, 0.4375},
			{-0.5, 0.375, -0.4375, -0.4375, 0.4375, 0.4375},
			{-0.5, -0.4375, -0.4375, -0.4375, -0.375, 0.4375},
			{-0.5, 0.25, -0.375, -0.4375, 0.3125, 0.375},
			{-0.5, -0.3125, -0.375, -0.4375, -0.25, 0.375},
			-- back (Z+)
			{-0.4375, -0.4375, 0.4375, -0.375, 0.4375, 0.5},
			{-0.3125, -0.4375, 0.4375, -0.25, 0.4375, 0.5},
			{0.25, -0.4375, 0.4375, 0.3125, 0.4375, 0.5},
			{0.375, -0.4375, 0.4375, 0.4375, 0.4375, 0.5},
			{-0.4375, 0.375, 0.4375, 0.4375, 0.4375, 0.5},
			{-0.4375, -0.4375, 0.4375, 0.4375, -0.375, 0.5},
			{-0.375, 0.25, 0.4375, 0.375, 0.3125, 0.5},
			{-0.375, -0.3125, 0.4375, 0.375, -0.25, 0.5},
			-- front (Z-)
			{0.375, -0.4375, -0.5, 0.4375, 0.4375, -0.4375},
			{0.25, -0.4375, -0.5, 0.3125, 0.4375, -0.4375},
			{-0.3125, -0.4375, -0.5, -0.25, 0.4375, -0.4375},
			{-0.4375, -0.4375, -0.5, -0.375, 0.4375, -0.4375},
			{-0.4375, 0.375, -0.5, 0.4375, 0.4375, -0.4375},
			{-0.4375, -0.4375, -0.5, 0.4375, -0.375, -0.4375},
			{-0.375, 0.25, -0.5, 0.375, 0.3125, -0.4375},
			{-0.375, -0.3125, -0.5, 0.375, -0.25, -0.4375},
			-- corner frame
			{-0.4375, 0.4375, 0.4375, 0.4375, 0.5, 0.5},
			{-0.4375, -0.5, 0.4375, 0.4375, -0.4375, 0.5},
			{-0.5, -0.5, 0.4375, -0.4375, 0.5, 0.5},
			{0.4375, -0.5, 0.4375, 0.5, 0.5, 0.5},
			{-0.5, 0.4375, -0.4375, -0.4375, 0.5, 0.4375},
			{-0.5, -0.5, -0.4375, -0.4375, -0.4375, 0.4375},
			{0.4375, 0.4375, -0.4375, 0.5, 0.5, 0.4375},
			{0.4375, -0.5, -0.4375, 0.5, -0.4375, 0.4375},
			{-0.5, 0.4375, -0.5, 0.5, 0.5, -0.4375},
			{-0.5, -0.5, -0.5, 0.5, -0.4375, -0.4375},
			{0.4375, -0.4375, -0.5, 0.5, 0.4375, -0.4375},
			{-0.5, -0.4375, -0.5, -0.4375, 0.4375, -0.4375},
			-- center mass 2px--0.0625 / 4px--0.125 / 6px--0.1875
			{-0.125, -0.125, -0.125, 0.125, 0.125, 0.125},
		},
	},
	selection_box = {
		type = "fixed",
		fixed = {
			{-0.5, -0.5, -0.5, 0.5, 0.5, 0.5},
		},
	},
	mesecons = {effector = {
        rules = nbea_rules,
        action_on = function (pos, node)
            minetest.swap_node(pos, {name = "nbea:nbox_005", param2 = node.param2})
        end,
    }},
})

minetest.override_item("nbea:nbox_003", {
	light_source = 5,
	groups = {cracky = 3,  mesecon_effector_off = 1, mesecon = 3},
	mesecons = {effector = {
        rules = nbea_rules,
        action_on = function (pos, node)
            minetest.swap_node(pos, {name = "nbea:nbox_003_on", param2 = node.param2})
        end,
    }}
})

minetest.override_item("nbea:nbox_004", {
	groups = {cracky = 1, mesecon = 1},
	mesecons = {receptor = {
		state = mesecon.state.on
	}}
})

minetest.override_item("nbea:nbox_005", {
	light_source = 8,
	groups = {cracky = 3, mesecon = 1, not_in_creative_inventory = 1},
    	drop = "nbea:nbox_005_off",
	mesecons = {effector = {
        rules = nbea_rules,
        action_off = function (pos, node)
            minetest.swap_node(pos, {name = "nbea:nbox_005_off", param2 = node.param2})
        end,
    }}
})

-- ABM
minetest.register_abm({
	nodenames = {"nbea:nbox_003_on"},
	interval = 1,
	chance = 1,
	catch_up = false,
	action = function(pos, node)
            local image_number = math.random(4)
            minetest.add_particlespawner({
                amount = 50,
                time = 1,
                minpos = {x=pos.x-0.15, y=pos.y-0.15, z=pos.z-0.15},
                maxpos = {x=pos.x+0.15, y=pos.y+0.15, z=pos.z+0.15},
                minvel = {x=-0.01, y=-0.02, z=-0.01},
                maxvel = {x=0.005,  y=0.005,  z=0.005},
                minacc = {x=-0.1,  y=-0.1,  z=-0.1},
                maxacc = {x=1.0, y=1.0, z=1.0},
                minexptime = 0.05,
                maxexptime = 0.15,
                minsize = 0.15,
                maxsize = 0.15,
                collisiondetection = true,
                collision_removal = true,
                glow = 10,
                texture = "nbea_core_particle.png",
            })
	end
})

minetest.register_node("nbea:nbox_009_on", {
	description = "Monochrome",
	tiles = {
		{image = "nbea_monochrome2.png",
		backface_culling = false,
			animation = {
				type = "vertical_frames",
				aspect_w = 16,
				aspect_h = 16,
				length = 3.0
			},
		}
	},
	drawtype = "nodebox",
	paramtype = "light",
	sunlight_propagates = true,
	is_ground_content = false,
    	drop = "nbea:nbox_009",
	groups = {cracky = 3, mesecon = 1, not_in_creative_inventory = 1},
	sounds = gal.node_sound_metal_defaults({
		place = {name = "default_metal_footstep", gain = 0.5},
		dig = {name = "default_metal_footstep", gain = 1.0},
		dug = {name = "default_metal_footstep", gain = 1.0},
	}),
	on_destruct = function(pos)
            nbea.stop_sound(pos)
	end,
	mesecons = {effector = {
        state = mesecon.state.on,
        action_off = function (pos, node)
            nbea.stop_sound(pos)
            minetest.swap_node(pos, {name = "nbea:nbox_009"})
        end,
    }},
	node_box = {
		type = "fixed",
		fixed = {
			-- top (Y+)
			{-0.0625, 0, -0.0625, 0.0625, 0.0625, 0.0625},
			{-0.125, 0.0625, -0.125, 0.125, 0.125, -0.0625},
			{-0.125, 0.0625, 0.0625, 0.125, 0.125, 0.125},
			{0.0625, 0.0625, -0.0625, 0.125, 0.125, 0.0625},
			{-0.125, 0.0625, -0.0625, -0.0625, 0.125, 0.0625},
			{0.125, 0.125, -0.1875, 0.1875, 0.1875, 0.1875},
			{-0.1875, 0.125, -0.1875, -0.125, 0.1875, 0.1875},
			{-0.125, 0.125, 0.125, 0.125, 0.1875, 0.1875},
			{-0.125, 0.125, -0.1875, 0.125, 0.1875, -0.125},
			{-0.25, 0.1875, 0.1875, 0.25, 0.25, 0.25},
			{-0.25, 0.1875, -0.25, 0.25, 0.25, -0.1875},
			{0.1875, 0.1875, -0.1875, 0.25, 0.25, 0.1875},
			{-0.25, 0.1875, -0.1875, -0.1875, 0.25, 0.1875},
			{-0.3125, 0.25, -0.3125, -0.25, 0.3125, 0.3125},
			{0.25, 0.25, -0.3125, 0.3125, 0.3125, 0.3125},
			{-0.25, 0.25, -0.3125, 0.25, 0.3125, -0.25},
			{-0.25, 0.25, 0.25, 0.25, 0.3125, 0.3125},
			{-0.375, 0.3125, 0.3125, 0.375, 0.375, 0.375},
			{-0.375, 0.3125, -0.375, 0.375, 0.375, -0.3125},
			{0.3125, 0.3125, -0.3125, 0.375, 0.375, 0.3125},
			{-0.375, 0.3125, -0.3125, -0.3125, 0.375, 0.3125},
			{-0.4375, 0.375, -0.4375, -0.375, 0.4375, 0.4375},
			{0.375, 0.375, -0.4375, 0.4375, 0.4375, 0.4375},
			{-0.4375, 0.375, 0.375, 0.4375, 0.4375, 0.4375},
			{-0.375, 0.375, -0.4375, 0.375, 0.4375, -0.375},
			-- bottom (Y-)
			{-0.0625, -0.0625, -0.0625, 0.0625, -0, 0.0625},
			{0.0625, -0.125, -0.125, 0.125, -0.0625, 0.125},
			{-0.125, -0.125, -0.125, -0.0625, -0.0625, 0.125},
			{-0.0625, -0.125, -0.125, 0.0625, -0.0625, -0.0625},
			{-0.0625, -0.125, 0.0625, 0.0625, -0.0625, 0.125},
			{-0.1875, -0.1875, -0.1875, 0.1875, -0.125, -0.125},
			{-0.1875, -0.1875, 0.125, 0.1875, -0.125, 0.1875},
			{-0.1875, -0.1875, -0.125, -0.125, -0.125, 0.125},
			{0.125, -0.1875, -0.125, 0.1875, -0.125, 0.125},
			{-0.25, -0.25, -0.25, -0.1875, -0.1875, 0.25},
			{0.1875, -0.25, -0.25, 0.25, -0.1875, 0.25},
			{-0.1875, -0.25, -0.25, 0.1875, -0.1875, -0.1875},
			{-0.1875, -0.25, 0.1875, 0.1875, -0.1875, 0.25},
			{-0.3125, -0.3125, 0.25, 0.3125, -0.25, 0.3125},
			{-0.3125, -0.3125, -0.3125, 0.3125, -0.25, -0.25},
			{0.25, -0.3125, -0.25, 0.3125, -0.25, 0.25},
			{-0.3125, -0.3125, -0.25, -0.25, -0.25, 0.25},
			{-0.375, -0.375, -0.375, -0.3125, -0.3125, 0.375},
			{0.3125, -0.375, -0.375, 0.375, -0.3125, 0.375},
			{-0.3125, -0.375, -0.375, 0.3125, -0.3125, -0.3125},
			{-0.3125, -0.375, 0.3125, 0.3125, -0.3125, 0.375},
			{-0.4375, -0.4375, 0.375, 0.4375, -0.375, 0.4375},
			{-0.4375, -0.4375, -0.4375, 0.4375, -0.375, -0.375},
			{-0.4375, -0.4375, -0.4375, -0.375, -0.375, 0.4375},
			{0.375, -0.4375, -0.375, 0.4375, -0.375, 0.375},
			-- right (X+)
			{0, -0.0625, -0.0625, 0.0625, 0.0625, 0.0625},
			{0.0625, -0.125, -0.125, 0.125, 0.125, -0.0625},
			{0.0625, -0.125, 0.0625, 0.125, 0.125, 0.125},
			{0.0625, -0.125, -0.0625, 0.125, -0.0625, 0.0625},
			{0.0625, 0.0625, -0.0625, 0.125, 0.125, 0.0625},
			{0.125, -0.1875, -0.1875, 0.1875, -0.125, 0.1875},
			{0.125, 0.125, -0.1875, 0.1875, 0.1875, 0.1875},
			{0.125, -0.125, 0.125, 0.1875, 0.125, 0.1875},
			{0.125, -0.125, -0.1875, 0.1875, 0.125, -0.125},
			{0.1875, -0.25, 0.1875, 0.25, 0.25, 0.25},
			{0.1875, -0.25, -0.25, 0.25, 0.25, -0.1875},
			{0.1875, -0.25, -0.1875, 0.25, -0.1875, 0.1875},
			{0.1875, 0.1875, -0.1875, 0.25, 0.25, 0.1875},
			{0.25, 0.25, -0.3125, 0.3125, 0.3125, 0.3125},
			{0.25, -0.3125, -0.3125, 0.3125, -0.25, 0.3125},
			{0.25, -0.25, -0.3125, 0.3125, 0.25, -0.25},
			{0.25, -0.25, 0.25, 0.3125, 0.25, 0.3125},
			{0.3125, -0.375, 0.3125, 0.375, 0.375, 0.375},
			{0.3125, -0.375, -0.375, 0.375, 0.375, -0.3125},
			{0.3125, -0.375, -0.3125, 0.375, -0.3125, 0.3125},
			{0.3125, 0.3125, -0.3125, 0.375, 0.375, 0.3125},
			{0.375, 0.375, -0.4375, 0.4375, 0.4375, 0.4375},
			{0.375, -0.4375, -0.4375, 0.4375, -0.375, 0.4375},
			{0.375, -0.4375, 0.375, 0.4375, 0.4375, 0.4375},
			{0.375, -0.375, -0.4375, 0.4375, 0.375, -0.375},
			-- left (X-)
			{-0.0625, -0.0625, -0.0625, -0, 0.0625, 0.0625},
			{-0.125, -0.125, 0.0625, -0.0625, 0.125, 0.125},
			{-0.125, -0.125, -0.125, -0.0625, 0.125, -0.0625},
			{-0.125, -0.125, -0.0625, -0.0625, -0.0625, 0.0625},
			{-0.125, 0.0625, -0.0625, -0.0625, 0.125, 0.0625},
			{-0.1875, -0.1875, -0.1875, -0.125, -0.125, 0.1875},
			{-0.1875, 0.125, -0.1875, -0.125, 0.1875, 0.1875},
			{-0.1875, -0.125, -0.1875, -0.125, 0.125, -0.125},
			{-0.1875, -0.125, 0.125, -0.125, 0.125, 0.1875},
			{-0.25, -0.25, -0.25, -0.1875, 0.25, -0.1875},
			{-0.25, -0.25, 0.1875, -0.1875, 0.25, 0.25},
			{-0.25, -0.25, -0.1875, -0.1875, -0.1875, 0.1875},
			{-0.25, 0.1875, -0.1875, -0.1875, 0.25, 0.1875},
			{-0.3125, 0.25, -0.3125, -0.25, 0.3125, 0.3125},
			{-0.3125, -0.3125, -0.3125, -0.25, -0.25, 0.3125},
			{-0.3125, -0.25, 0.25, -0.25, 0.25, 0.3125},
			{-0.3125, -0.25, -0.3125, -0.25, 0.25, -0.25},
			{-0.375, -0.375, -0.375, -0.3125, 0.375, -0.3125},
			{-0.375, -0.375, 0.3125, -0.3125, 0.375, 0.375},
			{-0.375, -0.375, -0.3125, -0.3125, -0.3125, 0.3125},
			{-0.375, 0.3125, -0.3125, -0.3125, 0.375, 0.3125},
			{-0.4375, 0.375, -0.4375, -0.375, 0.4375, 0.4375},
			{-0.4375, -0.4375, -0.4375, -0.375, -0.375, 0.4375},
			{-0.4375, -0.4375, -0.4375, -0.375, 0.4375, -0.375},
			{-0.4375, -0.375, 0.375, -0.375, 0.375, 0.4375},
			-- back (Z+)
			{-0.0625, -0.0625, 0, 0.0625, 0.0625, 0.0625},
			{0.0625, -0.125, 0.0625, 0.125, 0.125, 0.125},
			{-0.125, -0.125, 0.0625, -0.0625, 0.125, 0.125},
			{-0.0625, -0.125, 0.0625, 0.0625, -0.0625, 0.125},
			{-0.0625, 0.0625, 0.0625, 0.0625, 0.125, 0.125},
			{-0.1875, -0.1875, 0.125, 0.1875, -0.125, 0.1875},
			{-0.1875, 0.125, 0.125, 0.1875, 0.1875, 0.1875},
			{-0.1875, -0.125, 0.125, -0.125, 0.125, 0.1875},
			{0.125, -0.125, 0.125, 0.1875, 0.125, 0.1875},
			{-0.25, -0.25, 0.1875, -0.1875, 0.25, 0.25},
			{0.1875, -0.25, 0.1875, 0.25, 0.25, 0.25},
			{-0.1875, -0.25, 0.1875, 0.1875, -0.1875, 0.25},
			{-0.1875, 0.1875, 0.1875, 0.1875, 0.25, 0.25},
			{-0.3125, 0.25, 0.25, 0.3125, 0.3125, 0.3125},
			{-0.3125, -0.3125, 0.25, 0.3125, -0.25, 0.3125},
			{0.25, -0.25, 0.25, 0.3125, 0.25, 0.3125},
			{-0.3125, -0.25, 0.25, -0.25, 0.25, 0.3125},
			{-0.375, -0.375, 0.3125, -0.3125, 0.375, 0.375},
			{0.3125, -0.375, 0.3125, 0.375, 0.375, 0.375},
			{-0.3125, -0.375, 0.3125, 0.3125, -0.3125, 0.375},
			{-0.3125, 0.3125, 0.3125, 0.3125, 0.375, 0.375},
			{-0.4375, 0.375, 0.375, 0.4375, 0.4375, 0.4375},
			{-0.4375, -0.4375, 0.375, 0.4375, -0.375, 0.4375},
			{-0.4375, -0.4375, 0.375, -0.375, 0.4375, 0.4375},
			{0.375, -0.375, 0.375, 0.4375, 0.375, 0.4375},
			-- front (Z-)
			{-0.0625, -0.0625, -0.0625, 0.0625, 0.0625, -0},
			{-0.125, -0.125, -0.125, -0.0625, 0.125, -0.0625},
			{0.0625, -0.125, -0.125, 0.125, 0.125, -0.0625},
			{-0.0625, -0.125, -0.125, 0.0625, -0.0625, -0.0625},
			{-0.0625, 0.0625, -0.125, 0.0625, 0.125, -0.0625},
			{-0.1875, -0.1875, -0.1875, 0.1875, -0.125, -0.125},
			{-0.1875, 0.125, -0.1875, 0.1875, 0.1875, -0.125},
			{0.125, -0.125, -0.1875, 0.1875, 0.125, -0.125},
			{-0.1875, -0.125, -0.1875, -0.125, 0.125, -0.125},
			{0.1875, -0.25, -0.25, 0.25, 0.25, -0.1875},
			{-0.25, -0.25, -0.25, -0.1875, 0.25, -0.1875},
			{-0.1875, -0.25, -0.25, 0.1875, -0.1875, -0.1875},
			{-0.1875, 0.1875, -0.25, 0.1875, 0.25, -0.1875},
			{-0.3125, 0.25, -0.3125, 0.3125, 0.3125, -0.25},
			{-0.3125, -0.3125, -0.3125, 0.3125, -0.25, -0.25},
			{-0.3125, -0.25, -0.3125, -0.25, 0.25, -0.25},
			{0.25, -0.25, -0.3125, 0.3125, 0.25, -0.25},
			{0.3125, -0.375, -0.375, 0.375, 0.375, -0.3125},
			{-0.375, -0.375, -0.375, -0.3125, 0.375, -0.3125},
			{-0.3125, -0.375, -0.375, 0.3125, -0.3125, -0.3125},
			{-0.3125, 0.3125, -0.375, 0.3125, 0.375, -0.3125},
			{-0.4375, 0.375, -0.4375, 0.4375, 0.4375, -0.375},
			{-0.4375, -0.4375, -0.4375, 0.4375, -0.375, -0.375},
			{0.375, -0.4375, -0.4375, 0.4375, 0.4375, -0.375},
			{-0.4375, -0.375, -0.4375, -0.375, 0.375, -0.375},
			-- corner frame
			{-0.4375, 0.4375, 0.4375, 0.4375, 0.5, 0.5},
			{-0.4375, -0.5, 0.4375, 0.4375, -0.4375, 0.5},
			{-0.5, -0.5, 0.4375, -0.4375, 0.5, 0.5},
			{0.4375, -0.5, 0.4375, 0.5, 0.5, 0.5},
			{-0.5, 0.4375, -0.4375, -0.4375, 0.5, 0.4375},
			{-0.5, -0.5, -0.4375, -0.4375, -0.4375, 0.4375},
			{0.4375, 0.4375, -0.4375, 0.5, 0.5, 0.4375},
			{0.4375, -0.5, -0.4375, 0.5, -0.4375, 0.4375},
			{-0.5, 0.4375, -0.5, 0.5, 0.5, -0.4375},
			{-0.5, -0.5, -0.5, 0.5, -0.4375, -0.4375},
			{0.4375, -0.4375, -0.5, 0.5, 0.4375, -0.4375},
			{-0.5, -0.4375, -0.5, -0.4375, 0.4375, -0.4375},
		},
	},
	selection_box = {
		type = "fixed",
		fixed = {
			{-0.5, -0.5, -0.5, 0.5, 0.5, 0.5},
		},
	},
})

minetest.override_item("nbea:nbox_009", {
	groups = {cracky = 3, mesecon_effector_off = 1, mesecon = 1},
	on_construct = function(pos)
            nbea.stop_sound(pos)
	end,
	mesecons = {effector = {
        state = mesecon.state.off,
        action_on = function (pos, node)
            minetest.swap_node(pos, {name = "nbea:nbox_009_on"})
            local spos = minetest.hash_node_position(pos)
            sounds[spos] =minetest.sound_play("nbea_mc",{pos=pos, max_hear_distance=10, gain=1.25, loop=true})
        end,
    }},
})
